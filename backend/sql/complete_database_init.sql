-- 完整的数据库初始化脚本
-- 包含诗人、诗歌、用户和关联数据

USE mianshigo;

-- 设置安全模式
SET FOREIGN_KEY_CHECKS = 0;
SET SQL_SAFE_UPDATES = 0;

-- =====================================
-- 1. 清理现有数据
-- =====================================
DELETE FROM question_bank_question where id >0;
DELETE FROM question where id >0;
DELETE FROM question_bank where id >0;
DELETE FROM user WHERE id != 1;  -- 保留ID为1的管理员用户

-- 重置自增ID
ALTER TABLE question_bank AUTO_INCREMENT = 1;
ALTER TABLE question AUTO_INCREMENT = 1;
ALTER TABLE question_bank_question AUTO_INCREMENT = 1;

-- =====================================
-- 2. 插入管理员用户
-- =====================================
INSERT IGNORE INTO user (id, userAccount, userPassword, userName, userRole, createTime, updateTime, isDelete) VALUES
(1, 'admin', 'b0dd3697a192885d7c055db46155b26a', '管理员', 'admin', NOW(), NOW(), 0);

-- =====================================
-- 3. 插入诗人数据（question_bank表）
-- =====================================
INSERT INTO question_bank (title, description, picture, userId, createTime, updateTime, isDelete) VALUES
-- 中国古代诗人
('李白', '唐代伟大的浪漫主义诗人，被誉为"诗仙"。其诗风豪放飘逸，想象丰富，语言流转自然，音律和谐多变。代表作有《静夜思》《将进酒》《蜀道难》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=李白', 1, NOW(), NOW(), 0),
('杜甫', '唐代伟大的现实主义诗人，被誉为"诗圣"。其诗深刻反映了社会现实，被称为"诗史"。代表作有《春望》《茅屋为秋风所破歌》《登高》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=杜甫', 1, NOW(), NOW(), 0),
('白居易', '唐代现实主义诗人，新乐府运动的倡导者。主张"文章合为时而著，歌诗合为事而作"。代表作有《长恨歌》《琵琶行》《赋得古原草送别》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=白居易', 1, NOW(), NOW(), 0),
('王维', '唐代山水田园派诗人，有"诗佛"之称。其诗风恬静淡远，寓禅理于诗情画意之中。代表作有《相思》《山居秋暝》《鸟鸣涧》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=王维', 1, NOW(), NOW(), 0),
('李清照', '宋代婉约词派代表，号易安居士，中国古代最杰出的女性词人。前期词风清丽，后期沉郁。代表作有《声声慢》《如梦令》《一剪梅》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=李清照', 1, NOW(), NOW(), 0),
('苏轼', '宋代文学家，豪放派词人代表，唐宋八大家之一。其词开豪放一派，对后世影响深远。代表作有《水调歌头·明月几时有》《念奴娇·赤壁怀古》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=苏轼', 1, NOW(), NOW(), 0),
('辛弃疾', '宋代豪放派词人，人称"词中之龙"。其词风格豪放，充满爱国激情。代表作有《破阵子·为陈同甫赋壮词以寄之》《永遇乐·京口北固亭怀古》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=辛弃疾', 1, NOW(), NOW(), 0),
('陆游', '宋代爱国诗人，一生笔耕不辍，诗风雄浑奔放，充满爱国热情。代表作有《示儿》《游山西村》《钗头凤》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=陆游', 1, NOW(), NOW(), 0),

-- 外国诗人
('威廉·莎士比亚', '英国文艺复兴时期最伟大的戏剧家、诗人，被誉为"英国文学之父"。创作了37部戏剧和154首十四行诗。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=莎士比亚', 1, NOW(), NOW(), 0),
('拜伦', '英国浪漫主义诗人，代表作有《恰尔德·哈洛尔德游记》《唐璜》等。其诗歌充满反叛精神和浪漫色彩。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=拜伦', 1, NOW(), NOW(), 0),
('普希金', '俄国伟大诗人，被誉为"俄国文学之父"。其诗歌语言优美，韵律和谐。代表作有《自由》《致大海》《叶甫盖尼·奥涅金》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=普希金', 1, NOW(), NOW(), 0),
('泰戈尔', '印度诗人、哲学家，1913年诺贝尔文学奖获得者。其诗歌充满哲理和人文关怀。代表作有《飞鸟集》《新月集》《吉檀迦利》等。', 'https://via.placeholder.com/150x150/4a7c59/ffffff?text=泰戈尔', 1, NOW(), NOW(), 0);

-- =====================================
-- 4. 插入诗歌数据（question表）
-- =====================================
INSERT INTO question (title, content, tags, answer, userId, createTime, updateTime, isDelete) VALUES

-- 李白的诗歌
('静夜思', '李白最著名的思乡诗，以简洁明快的语言表达了对故乡的深切思念，是中国古典诗歌的经典之作。', '["唐诗", "思乡", "李白", "五言绝句"]', 
'床前明月光，疑是地上霜。\n举头望明月，低头思故乡。', 1, NOW(), NOW(), 0),

('将进酒', '李白的代表作之一，以豪放的气势表现了诗人对人生的达观态度，体现了盛唐时代的精神风貌。', '["唐诗", "豪放", "李白", "七言歌行"]',
'君不见黄河之水天上来，奔流到海不复回。\n君不见高堂明镜悲白发，朝如青丝暮成雪。\n人生得意须尽欢，莫使金樽空对月。\n天生我材必有用，千金散尽还复来。\n烹羊宰牛且为乐，会须一饮三百杯。', 1, NOW(), NOW(), 0),

('蜀道难', '李白的代表作，以奇特的想象和夸张的手法描绘了蜀道的险峻，表现了诗人的浪漫主义风格。', '["唐诗", "李白", "七言古诗", "浪漫主义"]',
'噫吁嚱，危乎高哉！蜀道之难，难于上青天！\n蚕丛及鱼凫，开国何茫然！\n尔来四万八千岁，不与秦塞通人烟。', 1, NOW(), NOW(), 0),

-- 杜甫的诗歌
('春望', '杜甫在安史之乱中写下的忧国忧民之作，表现了诗人深沉的爱国情怀和对家人的思念。', '["唐诗", "爱国", "杜甫", "五言律诗"]',
'国破山河在，城春草木深。\n感时花溅泪，恨别鸟惊心。\n烽火连三月，家书抵万金。\n白头搔更短，浑欲不胜簪。', 1, NOW(), NOW(), 0),

('望岳', '杜甫早期作品，表现了诗人不怕困难、敢于攀登绝顶、俯视一切的雄心和气概。', '["唐诗", "励志", "杜甫", "五言古诗"]',
'岱宗夫如何？齐鲁青未了。\n造化钟神秀，阴阳割昏晓。\n荡胸生曾云，决眦入归鸟。\n会当凌绝顶，一览众山小。', 1, NOW(), NOW(), 0),

('茅屋为秋风所破歌', '杜甫的代表作，通过描写自己茅屋被秋风所破的遭遇，表现了诗人忧国忧民的博大胸怀。', '["唐诗", "现实主义", "杜甫", "七言歌行"]',
'八月秋高风怒号，卷我屋上三重茅。\n茅飞渡江洒江郊，高者挂罥长林梢，下者飘转沉塘坳。\n安得广厦千万间，大庇天下寒士俱欢颜！', 1, NOW(), NOW(), 0),

-- 白居易的诗歌
('赋得古原草送别', '白居易早期代表作，以"野火烧不尽，春风吹又生"的名句表现了野草顽强的生命力。', '["唐诗", "送别", "白居易", "五言律诗"]',
'离离原上草，一岁一枯荣。\n野火烧不尽，春风吹又生。\n远芳侵古道，晴翠接荒城。\n又送王孙去，萋萋满别情。', 1, NOW(), NOW(), 0),

('琵琶行（节选）', '白居易的长篇叙事诗，通过描写琵琶女的遭遇，抒发了诗人对人生的感慨。', '["唐诗", "叙事", "白居易", "七言歌行"]',
'浔阳江头夜送客，枫叶荻花秋瑟瑟。\n主人下马客在船，举酒欲饮无管弦。\n醉不成欢惨将别，别时茫茫江浸月。\n忽闻水上琵琶声，主人忘归客不发。', 1, NOW(), NOW(), 0),

-- 王维的诗歌
('相思', '王维的五言绝句代表作，以红豆为寄托，表达了对友人的深切思念。', '["唐诗", "思念", "王维", "五言绝句"]',
'红豆生南国，春来发几枝。\n愿君多采撷，此物最相思。', 1, NOW(), NOW(), 0),

('山居秋暝', '王维的山水诗代表作，描绘了秋日山居的清幽景色，体现了诗人的恬淡心境。', '["唐诗", "山水", "王维", "五言律诗"]',
'空山新雨后，天气晚来秋。\n明月松间照，清泉石上流。\n竹喧归浣女，莲动下渔舟。\n随意春芳歇，王孙自可留。', 1, NOW(), NOW(), 0),

('鸟鸣涧', '王维的山水诗，以动衬静，描绘了春山月夜的幽静景色。', '["唐诗", "山水", "王维", "五言绝句"]',
'人闲桂花落，夜静春山空。\n月出惊山鸟，时鸣春涧中。', 1, NOW(), NOW(), 0),

-- 李清照的词
('声声慢·寻寻觅觅', '李清照晚期代表作，以叠字开头，表现了词人晚年的孤寂和愁苦。', '["宋词", "愁思", "李清照", "慢词"]',
'寻寻觅觅，冷冷清清，凄凄惨惨戚戚。\n乍暖还寒时候，最难将息。\n三杯两盏淡酒，怎敌他、晚来风急！\n雁过也，正伤心，却是旧时相识。', 1, NOW(), NOW(), 0),

('如梦令·常记溪亭日暮', '李清照早期作品，回忆少女时代的欢乐时光，语言清新活泼。', '["宋词", "回忆", "李清照", "小令"]',
'常记溪亭日暮，沉醉不知归路。\n兴尽晚回舟，误入藕花深处。\n争渡，争渡，惊起一滩鸥鹭。', 1, NOW(), NOW(), 0),

-- 苏轼的词
('水调歌头·明月几时有', '苏轼的代表作，中秋佳作，表达了对弟弟的思念和对人生的哲理思考。', '["宋词", "思亲", "苏轼", "中词"]',
'明月几时有？把酒问青天。\n不知天上宫阙，今夕是何年。\n我欲乘风归去，又恐琼楼玉宇，高处不胜寒。\n起舞弄清影，何似在人间。', 1, NOW(), NOW(), 0),

('念奴娇·赤壁怀古', '苏轼豪放词的代表作，通过对赤壁古战场的咏叹，抒发了对历史英雄的敬仰。', '["宋词", "怀古", "苏轼", "豪放词"]',
'大江东去，浪淘尽，千古风流人物。\n故垒西边，人道是，三国周郎赤壁。\n乱石穿空，惊涛拍岸，卷起千堆雪。\n江山如画，一时多少豪杰。', 1, NOW(), NOW(), 0),

-- 外国诗歌
('十四行诗第18首', '莎士比亚最著名的十四行诗之一，以夏日比喻爱人，表达了爱情的永恒。', '["英国诗歌", "爱情", "莎士比亚", "十四行诗"]',
'Shall I compare thee to a summer\'s day?\nThou art more lovely and more temperate:\nRough winds do shake the darling buds of May,\nAnd summer\'s lease hath all too short a date.', 1, NOW(), NOW(), 0),

('致大海', '普希金的代表作，以大海为象征，表达了对自由的向往和对暴政的憎恨。', '["俄国诗歌", "自由", "普希金", "抒情诗"]',
'再见吧，自由的元素！\n这是你最后一次在我的眼前，\n翻滚着蔚蓝色的波浪，\n和闪耀着娇美的容光。', 1, NOW(), NOW(), 0),

('飞鸟集（节选）', '泰戈尔的散文诗代表作，富含哲理，语言优美，体现了诗人的人生智慧。', '["印度诗歌", "哲理", "泰戈尔", "散文诗"]',
'生如夏花之绚烂，死如秋叶之静美。\n世界以痛吻我，要我报之以歌。\n天空虽不曾留下痕迹，但我已飞过。', 1, NOW(), NOW(), 0);

-- =====================================
-- 5. 建立诗人和诗歌的关联关系
-- =====================================
INSERT INTO question_bank_question (questionBankId, questionId, userId, createTime, updateTime) VALUES
-- 李白（ID=1）的诗歌
(1, 1, 1, NOW(), NOW()),   -- 静夜思
(1, 2, 1, NOW(), NOW()),   -- 将进酒
(1, 3, 1, NOW(), NOW()),   -- 蜀道难

-- 杜甫（ID=2）的诗歌
(2, 4, 1, NOW(), NOW()),   -- 春望
(2, 5, 1, NOW(), NOW()),   -- 望岳
(2, 6, 1, NOW(), NOW()),   -- 茅屋为秋风所破歌

-- 白居易（ID=3）的诗歌
(3, 7, 1, NOW(), NOW()),   -- 赋得古原草送别
(3, 8, 1, NOW(), NOW()),   -- 琵琶行（节选）

-- 王维（ID=4）的诗歌
(4, 9, 1, NOW(), NOW()),   -- 相思
(4, 10, 1, NOW(), NOW()),  -- 山居秋暝
(4, 11, 1, NOW(), NOW()),  -- 鸟鸣涧

-- 李清照（ID=5）的诗歌
(5, 12, 1, NOW(), NOW()),  -- 声声慢
(5, 13, 1, NOW(), NOW()),  -- 如梦令

-- 苏轼（ID=6）的诗歌
(6, 14, 1, NOW(), NOW()),  -- 水调歌头·明月几时有
(6, 15, 1, NOW(), NOW()),  -- 念奴娇·赤壁怀古

-- 莎士比亚（ID=9）的诗歌
(9, 16, 1, NOW(), NOW()),  -- 十四行诗第18首

-- 普希金（ID=11）的诗歌
(11, 17, 1, NOW(), NOW()), -- 致大海

-- 泰戈尔（ID=12）的诗歌
(12, 18, 1, NOW(), NOW()); -- 飞鸟集（节选）

-- =====================================
-- 6. 恢复安全设置
-- =====================================
SET FOREIGN_KEY_CHECKS = 1;
SET SQL_SAFE_UPDATES = 1;

-- =====================================
-- 7. 验证数据插入结果
-- =====================================
SELECT '=== 数据库初始化完成 ===' as '状态';

SELECT '=== 诗人列表 ===' as '信息';
SELECT id as '诗人ID', title as '诗人姓名', 
       SUBSTRING(description, 1, 50) as '简介预览',
       (SELECT COUNT(*) FROM question_bank_question WHERE questionBankId = question_bank.id) as '诗歌数量'
FROM question_bank 
WHERE isDelete = 0 
ORDER BY id;

SELECT '=== 诗歌统计 ===' as '信息';
SELECT 
    COUNT(*) as '总诗歌数',
    COUNT(DISTINCT qbq.questionBankId) as '有诗歌的诗人数',
    AVG(poem_count) as '平均每位诗人诗歌数'
FROM (
    SELECT questionBankId, COUNT(*) as poem_count
    FROM question_bank_question
    GROUP BY questionBankId
) as stats, question_bank_question qbq;

SELECT '=== 关联关系验证 ===' as '信息';
SELECT 
    qb.title as '诗人',
    COUNT(qbq.questionId) as '诗歌数量',
    GROUP_CONCAT(q.title SEPARATOR ', ') as '诗歌列表'
FROM question_bank qb
LEFT JOIN question_bank_question qbq ON qb.id = qbq.questionBankId
LEFT JOIN question q ON qbq.questionId = q.id
WHERE qb.isDelete = 0
GROUP BY qb.id, qb.title
ORDER BY qb.id;

SELECT '=== 初始化完成！现在可以正常访问诗人列表了 ===' as '提示';






